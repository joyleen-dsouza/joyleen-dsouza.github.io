const poems = [
	{
		title: 'Abandoned',
		lines: [
			'Where am I? I know not',
			'The way back home, I forgot',
			'Is this my reward for loyalty?',
			'All the love and care just empty?',
			'',
			'I miss those hugs, miss that food',
			'The people are here are not so good',
			'Trash is what fills my stomach',
			"With heartless creatures, I'm stuck.",
			'',
			'Pipes and footpath as my bed',
			'All I have is tears to shed',
			'Nights of comfort now deprived',
			'Living the days only terrified.',
			'',
			'Just a rumour that you hear',
			'Made you abandon me forever',
			'I wait to be called by my name',
			"Won't things ever be the same?",
			'',
			'Am I still your Oscar',
			'Or just a random dog here?',
			'Will I ever again get love',
			'Or forever be a trivial bhow?',
		],
		imgSrc: 'images/abandoned.jpg',
		imgAltText: 'dog image',
		date: '2020-05',
	},
	{
		title: 'Deceiving Flower',
		lines: [
			'In this land of thorns',
			'Full of grief and full of mourns',
			'You bloomed like a flower',
			'Was it love and care to shower?',
			'',
			'Like a flower to a bee',
			'You were more than that to me',
			'Like flowers for the altar',
			'You always adorned my prayer',
			'',
			'I watered you day and night',
			'Only expected to be treated right',
			'Petals that seemed arms of love',
			'Are brutal swords of anguish now',
			'',
			'You used and abused and left me',
			'Now not even thorns to protect me',
			'The beautiful flower I thought you were',
			"Ended up decorating my soul's grave",
		],
		imgSrc: 'images/deceivingflower.jpg',
		imgAltText: 'flower image',
		date: '2019-07',
	},
	{
		title: 'Nightmare',
		lines: [
			'At the dawn',
			'I still had yawn',
			'The night so deep',
			'But still no sleep',
			'',
			'Thoughts that came',
			'Drove me insane',
			'You would be there',
			'But not in my air',
			'',
			'You would sing',
			'And give her the ring',
			'But what if that she',
			"Wouldn't be me",
			'',
			'The anxiety flew',
			"Coz it wasn't true",
			'You are mine',
			'And me forever thine',
		],
		imgSrc: 'images/nightmare.jpg',
		imgAltText: 'moon image',
		date: '2019-06',
	},
	{
		title: 'She',
		lines: [
			'All she needs is',
			'Not power, not authority, not sympathy.',
			'A life that isnt controlled by the thoughts of the society.',
			'A life that doesnt objectify us.',
			'A life that isnt suppressed for the honour of the family.',
			'A life that isnt considered a burden for anyone.',
			'A life that isnt mocked continuously.',
			'A life with equal opportunities.',
			'A life having the freedom to fly high.',
			'A life that is secure at all times of the day.',
			'All she needs is a life with just the right amount of respect!',
		],
		imgSrc: 'images/she.jpg',
		imgAltText: 'picture of a girl',
		date: '2021-02',
	},
	{
		title: 'What if I say',
		lines: [
			'What if I say,',
			'I was broken when you left',
			'Day and night I had wept',
			'My soul is what you tore',
			"But still I'll love you more",
			'',
			'What if I say,',
			'I still wait for your call',
			'Search my peace in alcohol',
			'Self worth burnt to cinder',
			'But will care for you forever',
			'',
			'What if I say,',
			"Living without you, I can't",
			'I will be the way you want',
			'Will always give you plenty',
			"Even though right now I'm empty",
			'',
			'Then will you,',
			'Come back to me',
			'And set my achy soul free',
			'Love and respect me just a little',
			"And never break my heart that's brittle?",
		],
		imgSrc: 'images/whatif.jpg',
		imgAltText: 'broken glass',
		date: '2020-04',
	},
	{
		title: 'Friend',
		lines: [
			"I know you feel 'Lost'",
			"Thoughts like 'What I've done'",
			"With a 'faint' idea of what's yet to come",
			"All good memories 'forgotten'",
			"Negative thoughts 'crawling' in your head",
			"With positivity being 'invisible'",
			"But 'in the end'",
			"You are going to win this 'war'",
			"'Roads untravelled' always bring fear",
			"Just know that you are 'halfway right'",
			"I know it is always 'easier to run'",
			"But you are not someone who would 'runaway'",
			"So all the doubts, just 'burn it down'",
			"Negativity, just 'bleed it out'",
			"Soon there will be 'no more sorrow'",
			"And you will 'wake' up to a better tomorrow",
			"It does feel 'heavy' 'from the inside'",
			"But 'don't stay' in this gloominess",
			"There is no choice to have 'given up'",
			"The 'rebellion' in you will have to revolt",
			"Just take 'one step closer'",
			"Towards 'the radiance' of hope",
			"Fight with 'hands held high' 'until it's gone'",
			"Don't forget you are 'not alone'",
			"It might feel like 'nobody's listening'",
			"But remember, I'm always there 'with you'",
		],
		imgSrc: 'images/friend.jpg',
		imgAltText: 'handshake',
		date: '2023-05',
	},
	{
		title: 'Fate',
		lines: [
			'Questions is what remains',
			'With no answers at all',
			'Fate having its own way',
			'Demanding to surrender it all',
			'Reminding that mere humans',
			'Have no powers at all',
		],
		imgSrc: 'images/fate.jpg',
		imgAltText: 'question mark',
		date: '2020-06',
	},
	{
		title: 'Yearn',
		lines: [
			'The stars, the coffee, the chorus',
			'Why is nothing the same',
			'Is it within us or between us',
			'That something has changed',
			'',
			'The one I search in your eyes is lost',
			'The one in the mirror is now unfound',
			'Someone who meant the world to me',
			'Now just breathes on this earth guilt free',
			'',
			'People change with time they say',
			'Come in your life to just walk away',
			'The good morning that started my day',
			'Is now said in a formal way',
			'',
			'We cross paths with awkward smiles',
			'Once promised to walk together miles',
			'All I have with memories bittersweet',
			'Is a desire we never meet',
		],
		imgSrc: 'images/yearn.jpg',
		imgAltText: 'yearn',
		date: '2023-11',
	},
];

/**
 * Clears the modal content and hide it
 */
function hideModal() {
	modal.classList.remove('visuallyshow');
	setTimeout(() => modal.classList.remove('show'), 700);

	modalContent.innerHTML = '';
}

/**
 * Appends the DOM into the modal content and displays the modal
 * @param {HTMLElement} dom Document element that is to be appended to modal content
 */
function showModal(dom) {
	modalContent.appendChild(dom);

	modal.classList.add('show');
	setTimeout(() => modal.classList.add('visuallyshow'), 1);
}

/**
 * Generates DOM for displaying poem on modal
 * @param {Object} poem Poem from poems array
 * @returns HTMLElement of generated DOM for modal
 */
function createPoemDomForModal(poem) {
	/* Creates this HTML element 

	<div class="poem">
		<div class="title">
			<h3>Title</h3>
		</div>
		<div class="poem-lines">
			<p>line 1</p>
			<p>line 2</p>
			<p>line 3</p>
		</div>
		<span class="date">Sep, 2023</span>
	</div>
	*/

	// init the reveal title to animate on scroll
	revealTitle.textContent = poem.title;

	// title
	const title = document.createElement('div');
	title.classList.add('title');
	const titleName = document.createElement('h3');
	titleName.textContent = poem.title;
	title.appendChild(titleName);

	// poem content
	const poemContent = document.createElement('div');
	poemContent.classList.add('poem-lines');

	// append poem lines
	poem.lines.forEach(line => {
		let pLine = document.createElement('p');
		pLine.textContent = line;

		if (line.length === 0 || line === '')
			pLine = document.createTextNode('\u00A0');

		poemContent.appendChild(pLine);
	});

	// date, format - Sep, 2023
	const date = document.createElement('span');
	date.classList.add('date');
	date.textContent = new Date(poem.date)
		.toLocaleString('en-US', {
			month: 'short',
			year: 'numeric',
		})
		.replace(' ', ', ');

	// append title, poem content and date to final element
	const poemDiv = document.createElement('div');
	poemDiv.classList.add('poem');

	poemDiv.appendChild(title);
	poemDiv.appendChild(poemContent);
	poemDiv.appendChild(date);

	return poemDiv;
}

/**
 * Generates DOM for displaying poem tile on the home page
 * @param {Object} poem Poem from poems array
 * @returns HTMLElement for tile to display on the home page
 */
function createPoemTileDom(poem) {
	/* Creates this HTML element 
	
	<div class="tile">
		<span>Friend</span>
		<div class="tile-img-div">
			<img
				class="tile-img"
				src="images/friend.jpg"
				alt="handshake"
			/>
		</div>
	</div>
	*/

	// title
	const title = document.createElement('span');
	title.textContent = poem.title;

	// tile image
	const img = document.createElement('img');
	img.classList.add('tile-img');
	img.setAttribute('src', poem.imgSrc);
	img.setAttribute('alt', poem.imgAltText);

	// tile image container
	const div = document.createElement('div');
	div.classList.add('tile-img-div');
	div.appendChild(img);

	// append everything
	const poemTile = document.createElement('div');
	poemTile.classList.add('tile');

	// attach poem, title and date fields, helps in sorting
	poemTile.poem = poem;
	poemTile.title = poem.title;
	poemTile.date = poem.date;

	poemTile.appendChild(title);
	poemTile.appendChild(div);

	return poemTile;
}

/**
 * Toggles the sort button and sets the data prop
 */
function toggleSortBtn() {
	if (sortBy.dataset.sort === 'asc') {
		sortBy.dataset.sort = 'desc';
		sortBy.textContent = '⬆';
	} else {
		sortBy.dataset.sort = 'asc';
		sortBy.textContent = '⬇';
	}
}

/**
 * Reorders tiles on the home page
 * @param {String} filterBy Filter by - date/a-z
 * @param {String} sortBy Sort - asc/desc
 */
function reorderItems(filterBy, sortBy) {
	let divs = [...poemList.querySelectorAll('.tile')];
	divs.forEach(div => div.remove());
	divs = sortItems(divs, filterBy, sortBy);
	divs.forEach(div => poemList.append(div));
}

/**
 * Sorts the given array based on the params provided
 * @param {Array} arr Array to be sorted
 * @param {String} filterBy Filter by - date/a-z
 * @param {String} sortBy Sort - asc/desc
 * @returns The resultant array
 */
function sortItems(arr, filterBy, sortBy) {
	if (filterBy === 'a-z') {
		if (sortBy === 'asc')
			return arr.sort((a, b) => a.title.localeCompare(b.title));
		else return arr.sort((a, b) => b.title.localeCompare(a.title));
	} else {
		if (sortBy === 'asc')
			return arr.sort((a, b) => new Date(a.date) - new Date(b.date));
		else return arr.sort((a, b) => new Date(b.date) - new Date(a.date));
	}
}

/**
 * Reveals the title on the top on scroll (while displaying the modal)
 */
function revealTitleOnScroll() {
	const title = modal.querySelector('.title');
	if (!title) return;

	if (title.getBoundingClientRect().bottom < 80)
		revealTitle.classList.add('active');
	else revealTitle.classList.remove('active');
}

// main

const modal = document.querySelector('.modal');
const modalContent = document.querySelector('.modal-content');
const closeModal = document.querySelector('.modal-close span');
const revealTitle = modal.querySelector('.reveal-title');
const poemList = document.querySelector('.poem-list');
const filterBy = document.querySelector('.filter-by');
const sortBy = document.querySelector('.sort-by');

// modal action
// closing the modal
closeModal.addEventListener('click', hideModal);
window.addEventListener('click', e => {
	if (e.target === modal) hideModal();
});
// transition the title to top on scroll
modal.addEventListener('scroll', revealTitleOnScroll);

// event listeners for reordering tiles
filterBy.addEventListener('change', () =>
	reorderItems(filterBy.value, sortBy.dataset.sort)
);
sortBy.addEventListener('click', () => {
	toggleSortBtn();
	reorderItems(filterBy.value, sortBy.dataset.sort);
});

// adding event delegation listeners to display modal for poems
poemList.addEventListener('click', e => {
	if (e.target.classList.contains('poem-list')) return;

	const target = e.target.closest('.tile');
	showModal(createPoemDomForModal(target.poem));

	// do not preserve the scrolled state, scroll back to top on modal display
	modal.scrollTo(0, 0);
});

// render tiles on page load, default filter: a-z, sort: asc
sortItems(poems, 'a-z', 'asc').forEach(p =>
	poemList.appendChild(createPoemTileDom(p))
);
